<div class="employee-dashboard p-4">
  <router-outlet></router-outlet>

  <!-- Quick Actions -->
  <div class="mb-8">
    <div class="flex flex-wrap gap-4 mb-4">
      <button mat-raised-button color="primary" (click)="openLeaveRequestForm()" class="flex items-center gap-2">
        <mat-icon>add</mat-icon>
        New Leave Request
      </button>
    </div>
  </div>

  <!-- Leave Balance Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <mat-card *ngFor="let balance of leaveBalances" class="leave-balance-card">
      <mat-card-header>
        <mat-card-title>{{ getLeaveTypeDisplay(balance.leaveType) }}</mat-card-title>
        <mat-card-subtitle>Remaining: {{ balance.remainingDays }} days</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
          <div class="bg-blue-600 h-2.5 rounded-full" [style.width.%]="balance.usedPercentage"></div>
        </div>
        <div class="flex justify-between text-sm text-gray-500">
          <span>Used: {{ balance.usedDays || 0 }}/{{ balance.totalDays }} days</span>
          <span>Pending: {{ balance.pendingDays || 0 }} days</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Recent Leave Requests -->
  <mat-card>
    <mat-card-header>
      <mat-card-title>Recent Leave Requests</mat-card-title>
      <button mat-button color="primary" [routerLink]="['/employee/leaves']" class="ml-auto">
        View All
      </button>
    </mat-card-header>
    
    <mat-card-content>
      <!-- Debug Info (remove in production) -->
      <div *ngIf="false" class="debug-info bg-gray-100 p-4 mb-4 rounded text-xs">
        <h4 class="font-bold">Debug Info:</h4>
        <pre>Loading: {{ loading }}</pre>
        <pre>Recent Requests Count: {{ recentRequests.length }}</pre>
        <pre>Recent Requests: {{ recentRequests | json }}</pre>
      </div>

      <div *ngIf="loading" class="flex justify-center p-8">
        <mat-spinner diameter="40"></mat-spinner>
      </div>

      <table mat-table [dataSource]="recentRequests" *ngIf="!loading && recentRequests.length > 0" class="w-full">
        <!-- Start Date Column -->
        <ng-container matColumnDef="startDate">
          <th mat-header-cell *matHeaderCellDef>Start Date</th>
          <td mat-cell *matCellDef="let request">
            {{ request.startDate | date: 'mediumDate' }}
          </td>
        </ng-container>

        <!-- End Date Column -->
        <ng-container matColumnDef="endDate">
          <th mat-header-cell *matHeaderCellDef>End Date</th>
          <td mat-cell *matCellDef="let request">
            {{ request.endDate | date: 'mediumDate' }}
          </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let request">
            {{ getLeaveTypeDisplay(request.leaveType) }}
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let request">
            <span class="px-2 py-1 rounded-full text-xs font-medium" 
                  [ngClass]="getStatusClass(request.status)">
              {{ request.status }}
            </span>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let request" class="text-right">
            <button mat-icon-button [matMenuTriggerFor]="menu" *ngIf="request.status === 'PENDING'">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="cancelRequest(request.id)">
                <mat-icon>cancel</mat-icon>
                <span>Cancel Request</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <div *ngIf="!loading && recentRequests.length === 0" class="text-center py-8 text-gray-500">
        <mat-icon class="text-4xl mb-2">event_available</mat-icon>
        <p>No leave requests found</p>
        <p class="text-xs text-gray-400 mt-2">If you expected to see requests, please check the console for errors.</p>
        <button mat-button color="primary" (click)="openLeaveRequestForm()" class="mt-4">
          <mat-icon>add</mat-icon>
          Request Time Off
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
